seed: 1234

# Backend selection.
backend: rl4co

# Environment and policy selection.
env_name: tsp  # tsp | cvrp | jssp | fjsp | ffsp
policy_name: ""  # auto: pomo (tsp/cvrp), l2d (jssp/fjsp), matnet (ffsp)
policy_kwargs: {}
env_kwargs: {}

# Generator parameters (overrides per-size key automatically).
# - tsp/cvrp: num_loc
# - jssp/fjsp: num_jobs
# - ffsp: num_job
generator_params: {}

# Rollout strategy for multi-solution preference comparisons:
# - policy_multistart: use policy's multistart decoding (pomo/matnet)
# - batchify_sampling: repeat instances and sample multiple rollouts
rollout_strategy: auto

# Objective sign from reward:
# - neg_reward (default): objective = -reward
# - reward: objective = reward
objective_sign: neg_reward

# Discovery loop.
generations: 10
population_size: 8
elite_size: 4
init_llm: 8
max_repair_rounds: 4

# Multi-fidelity budget.
f0_only: false
f1_steps: 0
hf_epochs: 10
hf_instances_per_epoch: 20000
f2_steps: 0
f3_enabled: false

# Early-eval horizon for baseline/candidates.
early_eval_epochs: 2
early_eval_instances_per_epoch: 10000

# HF training / evaluation config.
train_problem_size: 20
valid_problem_sizes: [20]
train_batch_size: 64
pomo_size: 20
learning_rate: 0.0003
weight_decay: 0.000001
alpha: 0.05
device: cuda
num_validation_episodes: 2000
validation_batch_size: 64
generalization_penalty_weight: 1.0
size_aggregation: cvar
size_cvar_alpha: 0.2
baseline_epoch_violation_weight: 0.0

# Gates (keep defaults from PTP).
pref_semantic_gate_enabled: true
pref_semantic_trials: 6
pref_semantic_batch_size: 128
pref_semantic_min_pass_rate: 0.5
pref_semantic_swap_tolerance: 0.01
pref_semantic_gap_min_ratio: 0.5

co_gate_enabled: true
co_sensitivity_min_abs_delta: 0.001
co_sensitivity_min_rel_delta: 0.01
co_invariance_max_abs_delta: 0.001
co_invariance_max_rel_delta: 0.01

grad_norm_max: 10.0
loss_soft_min: -5.0
loss_soft_max: 5.0
hidden_dynamic_gates_enabled: true
max_resample_rounds: 4

# Diversity / novelty.
novelty_behavior_deltas: [-10, -5, -2, -1, 0, 1, 2, 5, 10]
novelty_k: 5
novelty_ops_weight: 1.0
novelty_hparam_weight: 0.5
novelty_behavior_weight: 1.0
novelty_thought_weight: 0.25
diversity_archive_size: 32
burn_in_objectives_auto: true

operator_whitelist:
  - logsigmoid
  - softplus
  - sigmoid
  - exp
  - log
  - tanh
  - relu
  - clamp
  - normalize
  - zscore
  - rank_gap

prompts:
  generation: PTP/prompts/free_loss_generation.txt
  crossover: PTP/prompts/free_loss_crossover.txt
  e2: PTP/prompts/free_loss_e2.txt
  mutation: PTP/prompts/free_loss_mutation.txt
  m2: PTP/prompts/free_loss_m2.txt
  m3: PTP/prompts/free_loss_m3.txt
  repair: PTP/prompts/free_loss_repair.txt
  directed_repair: PTP/prompts/free_loss_directed_repair.txt
  expects_repair: PTP/prompts/free_loss_expects_repair.txt

output_root: runs/free_loss_discovery
